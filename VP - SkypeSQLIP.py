# coding=utf-8
import pprint
import sqlite3


def print_profile(skype_db):
    conn = sqlite3.connect(skype_db)
    db = conn.cursor()
    db.execute("SELECT fullname, skypename, city, country, datetime(profile_timestamp,'unixepoch') FROM Accounts;")
    for row in db:
        print('[*] -- Found Account --')
        print('[+] User: ' + str(row[0]))
        print('[+] Skype Username: ' + str(row[1]))
        print('[+] Location: ' + str(row[2]) + ',' + str(row[3]))
        print('[+] Profile Date: ' + str(row[4]))

    db.execute("SELECT ip_address, dispname FROM CallMembers;")
    duplicate_ip = []
    dict_array = {}
    for row in db:
        if row[0] and row[0] not in duplicate_ip:
            print('[*] -- Found IP --')
            print('[+] Skype Username: ' + str(row[1]))
            print('[+] IP: ' + str(row[0]))
            duplicate_ip.append(row[0])
            # If key does not exist, it returns new entry key:[] which can then allow appending,
            # else it returns key:values... for appending.
            dict_array.setdefault(row[1], []).append(row[0])
    pprint.pprint(dict_array)


def main():
    skype_db = r"C:\Users\xx\AppData\Roaming\Skype\xx.xx\main.db"
    print_profile(skype_db)


if __name__ == "__main__":
    main()
